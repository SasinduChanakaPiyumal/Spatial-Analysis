<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sasindu Chanaka Piyumal">

<title>Spatial Interpolation on Meuse Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="gstat_files/libs/clipboard/clipboard.min.js"></script>
<script src="gstat_files/libs/quarto-html/quarto.js"></script>
<script src="gstat_files/libs/quarto-html/popper.min.js"></script>
<script src="gstat_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="gstat_files/libs/quarto-html/anchor.min.js"></script>
<link href="gstat_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gstat_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="gstat_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="gstat_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="gstat_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial Interpolation on Meuse Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sasindu Chanaka Piyumal </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<section id="the-meuse-data-set-provided-by-package-sp-is-a-data-set-comprising-of-four-heavy-metals-measured-in-the-top-soil-in-a-flood-plain-along-the-river-meuse-along-with-a-handful-of-covariates.-the-process-governing-heavy-metal-distribution-seems-that-polluted-sediment-is-carried-by-the-river-and-mostly-deposited-close-to-the-river-bank-and-areas-with-low-elevation.-this-document-shows-a-geostatistical-analysis-of-this-data-set.-the-data-set-was-introduced-by-burrough-and-mcdonnell-1998." class="level4">
<h4 class="anchored" data-anchor-id="the-meuse-data-set-provided-by-package-sp-is-a-data-set-comprising-of-four-heavy-metals-measured-in-the-top-soil-in-a-flood-plain-along-the-river-meuse-along-with-a-handful-of-covariates.-the-process-governing-heavy-metal-distribution-seems-that-polluted-sediment-is-carried-by-the-river-and-mostly-deposited-close-to-the-river-bank-and-areas-with-low-elevation.-this-document-shows-a-geostatistical-analysis-of-this-data-set.-the-data-set-was-introduced-by-burrough-and-mcdonnell-1998.">The meuse data set provided by package sp is a data set comprising of four heavy metals measured in the top soil in a flood plain along the river Meuse, along with a handful of covariates. The process governing heavy metal distribution seems that polluted sediment is carried by the river, and mostly deposited close to the river bank, and areas with low elevation. This document shows a geostatistical analysis of this data set. The data set was introduced by Burrough and McDonnell, 1998.</h4>
</section>
</section>
<section id="load-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-and-data">Load Packages and Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"meuse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(meuse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(meuse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "x"       "y"       "cadmium" "copper"  "lead"    "zinc"    "elev"   
 [8] "dist"    "om"      "ffreq"   "soil"    "lime"    "landuse" "dist.m" </code></pre>
</div>
</div>
</section>
<section id="convert-to-spatial-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="convert-to-spatial-coordinates">Convert to Spatial Coordinates</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(meuse) <span class="ot">&lt;-</span> <span class="er">~</span>x <span class="sc">+</span> y</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(meuse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meuse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class SpatialPointsDataFrame
Coordinates:
     min    max
x 178605 181390
y 329714 333611
Is projected: NA 
proj4string : [NA]
Number of points: 155
Data attributes:
    cadmium           copper            lead            zinc       
 Min.   : 0.200   Min.   : 14.00   Min.   : 37.0   Min.   : 113.0  
 1st Qu.: 0.800   1st Qu.: 23.00   1st Qu.: 72.5   1st Qu.: 198.0  
 Median : 2.100   Median : 31.00   Median :123.0   Median : 326.0  
 Mean   : 3.246   Mean   : 40.32   Mean   :153.4   Mean   : 469.7  
 3rd Qu.: 3.850   3rd Qu.: 49.50   3rd Qu.:207.0   3rd Qu.: 674.5  
 Max.   :18.100   Max.   :128.00   Max.   :654.0   Max.   :1839.0  
                                                                   
      elev             dist               om         ffreq  soil   lime   
 Min.   : 5.180   Min.   :0.00000   Min.   : 1.000   1:84   1:97   0:111  
 1st Qu.: 7.546   1st Qu.:0.07569   1st Qu.: 5.300   2:48   2:46   1: 44  
 Median : 8.180   Median :0.21184   Median : 6.900   3:23   3:12          
 Mean   : 8.165   Mean   :0.24002   Mean   : 7.478                        
 3rd Qu.: 8.955   3rd Qu.:0.36407   3rd Qu.: 9.000                        
 Max.   :10.520   Max.   :0.88039   Max.   :17.000                        
                                    NA's   :2                             
    landuse       dist.m      
 W      :50   Min.   :  10.0  
 Ah     :39   1st Qu.:  80.0  
 Am     :22   Median : 270.0  
 Fw     :10   Mean   : 290.3  
 Ab     : 8   3rd Qu.: 450.0  
 (Other):25   Max.   :1000.0  
 NA's   : 1                   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(meuse)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x      y
1 181072 333611
2 181025 333558
3 181165 333537
4 181298 333484
5 181307 333330</code></pre>
</div>
</div>
</section>
<section id="zinc-concentration" class="level2">
<h2 class="anchored" data-anchor-id="zinc-concentration">Zinc Concentration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bubble</span>(meuse, <span class="st">"zinc"</span>,<span class="at">main =</span> <span class="st">"Zinc Concentration"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-data-on-a-regular-grid" class="level2">
<h2 class="anchored" data-anchor-id="spatial-data-on-a-regular-grid">Spatial data on a regular grid</h2>
<section id="a-grid-is-a-structured-framework-that-divides-spatial-data-into-equal-sized-cells-commonly-used-in-gis-remote-sensing-and-spatial-analysis.-it-standardizes-data-representation-making-computations-more-efficient-and-enabling-seamless-integration-with-machine-learning-models.-grids-help-interpolate-missing-values-enhance-visualization-e.g.-heatmaps-and-support-large-scale-spatial-operations.-they-are-essential-for-processing-geospatial-data-consistently-allowing-for-better-pattern-recognition-and-decision-making-in-fields-like-environmental-science-urban-planning-and-weather-forecasting." class="level4">
<h4 class="anchored" data-anchor-id="a-grid-is-a-structured-framework-that-divides-spatial-data-into-equal-sized-cells-commonly-used-in-gis-remote-sensing-and-spatial-analysis.-it-standardizes-data-representation-making-computations-more-efficient-and-enabling-seamless-integration-with-machine-learning-models.-grids-help-interpolate-missing-values-enhance-visualization-e.g.-heatmaps-and-support-large-scale-spatial-operations.-they-are-essential-for-processing-geospatial-data-consistently-allowing-for-better-pattern-recognition-and-decision-making-in-fields-like-environmental-science-urban-planning-and-weather-forecasting.">A grid is a structured framework that divides spatial data into equal-sized cells, commonly used in GIS, remote sensing, and spatial analysis. It standardizes data representation, making computations more efficient and enabling seamless integration with machine learning models. Grids help interpolate missing values, enhance visualization (e.g., heatmaps), and support large-scale spatial operations. They are essential for processing geospatial data consistently, allowing for better pattern recognition and decision-making in fields like environmental science, urban planning, and weather forecasting.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"meuse.grid"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meuse.grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x                y              part.a           part.b      
 Min.   :178460   Min.   :329620   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:179420   1st Qu.:330460   1st Qu.:0.0000   1st Qu.:0.0000  
 Median :179980   Median :331220   Median :0.0000   Median :1.0000  
 Mean   :179985   Mean   :331348   Mean   :0.3986   Mean   :0.6014  
 3rd Qu.:180580   3rd Qu.:332140   3rd Qu.:1.0000   3rd Qu.:1.0000  
 Max.   :181540   Max.   :333740   Max.   :1.0000   Max.   :1.0000  
      dist        soil     ffreq   
 Min.   :0.0000   1:1665   1: 779  
 1st Qu.:0.1193   2:1084   2:1335  
 Median :0.2715   3: 354   3: 989  
 Mean   :0.2971                    
 3rd Qu.:0.4402                    
 Max.   :0.9926                    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(meuse.grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
</section>
</section>
<section id="grid-into-spatial-coordinate" class="level2">
<h2 class="anchored" data-anchor-id="grid-into-spatial-coordinate">Grid into Spatial Coordinate</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(meuse.grid) <span class="ot">&lt;-</span> <span class="er">~</span>x<span class="sc">+</span>y</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(meuse.grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(meuse.grid) <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(meuse.grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
</div>
</section>
<section id="distance-to-river" class="level2">
<h2 class="anchored" data-anchor-id="distance-to-river">Distance to River</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(meuse.grid[<span class="st">"dist"</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Distance To River (Red = 0)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-interpolation-of-zinc-concentration" class="level2">
<h2 class="anchored" data-anchor-id="spatial-interpolation-of-zinc-concentration">Spatial Interpolation of Zinc Concentration</h2>
<section id="interpolation-using-inverse-distant-weighted-method-idw" class="level3">
<h3 class="anchored" data-anchor-id="interpolation-using-inverse-distant-weighted-method-idw">Interpolation using Inverse Distant Weighted Method (IDW)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>zinc.idw <span class="ot">&lt;-</span> <span class="fu">idw</span>(zinc<span class="sc">~</span><span class="dv">1</span> , meuse, meuse.grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[inverse distance weighted interpolation]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(zinc.idw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPixelsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(zinc.idw[<span class="st">"var1.pred"</span>],<span class="at">main =</span> <span class="st">"Zinc IDW Interpolations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="comparing-the-bubble-plot-of-zinc-measurements-with-the-map-showing-distances-to-the-river-reveals-that-higher-zinc-concentrations-are-found-near-the-river.-this-pattern-can-be-made-more-linear-by-applying-a-logarithmic-transformation-to-the-zinc-concentrations-and-using-the-square-root-of-the-distance-to-the-river." class="level4">
<h4 class="anchored" data-anchor-id="comparing-the-bubble-plot-of-zinc-measurements-with-the-map-showing-distances-to-the-river-reveals-that-higher-zinc-concentrations-are-found-near-the-river.-this-pattern-can-be-made-more-linear-by-applying-a-logarithmic-transformation-to-the-zinc-concentrations-and-using-the-square-root-of-the-distance-to-the-river.">Comparing the bubble plot of zinc measurements with the map showing distances to the river reveals that higher zinc concentrations are found near the river. This pattern can be made more linear by applying a logarithmic transformation to the zinc concentrations and using the square root of the distance to the river.</h4>
</section>
</section>
</section>
<section id="logarithmic-transformation-to-the-zinc-concentrations-with-the-square-root-of-the-distance-to-the-river" class="level2">
<h2 class="anchored" data-anchor-id="logarithmic-transformation-to-the-zinc-concentrations-with-the-square-root-of-the-distance-to-the-river">Logarithmic transformation to the zinc concentrations with the square root of the distance to the river</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="fu">sqrt</span>(dist), meuse)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="fu">sqrt</span>(dist),meuse))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="variograms" class="level2">
<h2 class="anchored" data-anchor-id="variograms">Variograms</h2>
<section id="a-variogram-is-a-geostatistical-tool-that-measures-how-spatial-data-points-are-correlated-based-on-their-separation-distance.-it-helps-identify-spatial-patterns-by-analyzing-how-the-difference-between-values-changes-with-distance.-the-variogram-is-essential-for-interpolation-methods-like-kriging-ensuring-accurate-spatial-predictions.-it-is-widely-used-in-fields-like-environmental-science-mining-and-agriculture-to-model-spatial-variability-and-optimize-data-analysis." class="level4">
<h4 class="anchored" data-anchor-id="a-variogram-is-a-geostatistical-tool-that-measures-how-spatial-data-points-are-correlated-based-on-their-separation-distance.-it-helps-identify-spatial-patterns-by-analyzing-how-the-difference-between-values-changes-with-distance.-the-variogram-is-essential-for-interpolation-methods-like-kriging-ensuring-accurate-spatial-predictions.-it-is-widely-used-in-fields-like-environmental-science-mining-and-agriculture-to-model-spatial-variability-and-optimize-data-analysis.">A variogram is a geostatistical tool that measures how spatial data points are correlated based on their separation distance. It helps identify spatial patterns by analyzing how the difference between values changes with distance. The variogram is essential for interpolation methods like kriging, ensuring accurate spatial predictions. It is widely used in fields like environmental science, mining, and agriculture to model spatial variability and optimize data analysis.</h4>
<section id="here-logzinc1-means-that-we-assume-a-constant-trend-for-the-variable-logzinc." class="level5">
<h5 class="anchored" data-anchor-id="here-logzinc1-means-that-we-assume-a-constant-trend-for-the-variable-logzinc.">Here, log(zinc)~1 means that we assume a constant trend for the variable log(zinc).</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lzn.vgm <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>, meuse)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>lzn.vgm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    np       dist     gamma dir.hor dir.ver   id
1   57   79.29244 0.1234479       0       0 var1
2  299  163.97367 0.2162185       0       0 var1
3  419  267.36483 0.3027859       0       0 var1
4  457  372.73542 0.4121448       0       0 var1
5  547  478.47670 0.4634128       0       0 var1
6  533  585.34058 0.5646933       0       0 var1
7  574  693.14526 0.5689683       0       0 var1
8  564  796.18365 0.6186769       0       0 var1
9  589  903.14650 0.6471479       0       0 var1
10 543 1011.29177 0.6915705       0       0 var1
11 500 1117.86235 0.7033984       0       0 var1
12 477 1221.32810 0.6038770       0       0 var1
13 452 1329.16407 0.6517158       0       0 var1
14 457 1437.25620 0.5665318       0       0 var1
15 415 1543.20248 0.5748227       0       0 var1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lzn.vgm , <span class="at">main =</span> <span class="st">"Empirical Variogram of log(zinc) ~ 1 "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="variogram-fitting" class="level2">
<h2 class="anchored" data-anchor-id="variogram-fitting">Variogram Fitting</h2>
<section id="how-to-assign-key-parameters-for-theoretical-variogram" class="level3">
<h3 class="anchored" data-anchor-id="how-to-assign-key-parameters-for-theoretical-variogram">How to assign key parameters for theoretical variogram</h3>
<ul>
<li><p><strong>Nugget (C₀):</strong></p>
<ul>
<li><p>Represents small-scale variation or measurement errors.</p></li>
<li><p>Determined by the variogram value at near-zero distance.</p></li>
</ul></li>
<li><p><strong>Sill (C + C₀):</strong></p>
<ul>
<li><p>The point where the variogram levels off, indicating the total variance.</p></li>
<li><p>Estimated from the plateau of the variogram plot.</p></li>
</ul></li>
<li><p><strong>Range (a):</strong></p>
<ul>
<li><p>The distance at which spatial correlation stops (where the variogram reaches the sill).</p></li>
<li><p>Estimated by observing where the empirical variogram flattens.</p></li>
</ul></li>
</ul>
</section>
<section id="selecting-a-variogram-model" class="level3">
<h3 class="anchored" data-anchor-id="selecting-a-variogram-model">Selecting a Variogram Model</h3>
<table class="caption-top table">
<caption>Variogram Model Selection</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Spherical</td>
<td>Increases rapidly, then levels off</td>
</tr>
<tr class="even">
<td>Exponential</td>
<td>Increases smoothly, never fully reaches sill</td>
</tr>
<tr class="odd">
<td>Gaussian</td>
<td>Smoothest, increases slowly at first</td>
</tr>
<tr class="even">
<td>Linear</td>
<td>Increases indefinitely</td>
</tr>
<tr class="odd">
<td>Matérn</td>
<td>Flexible model with an extra smoothness parameter</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="fitted-variogram" class="level2">
<h2 class="anchored" data-anchor-id="fitted-variogram">Fitted Variogram</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vgm(psill, model, range, nugget)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># psill represents the difference between the sill and nugget effect.</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>lzn.fit <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(lzn.vgm, <span class="at">model =</span> <span class="fu">vgm</span>(<span class="dv">1</span>,<span class="st">"Sph"</span>,<span class="dv">900</span>,<span class="dv">1</span>))     </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>lzn.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  model      psill    range
1   Nug 0.05066243   0.0000
2   Sph 0.59060780 897.0209</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lzn.vgm,lzn.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="log-transformation-of-data-relative-to-the-square-root" class="level2">
<h2 class="anchored" data-anchor-id="log-transformation-of-data-relative-to-the-square-root">Log transformation of data relative to the square root</h2>
<section id="why-these-transformations-are-used-in-variograms" class="level3">
<h3 class="anchored" data-anchor-id="why-these-transformations-are-used-in-variograms">Why these transformations are used in variograms:</h3>
<section id="logarithmic-transformations-help-compress-the-range-of-the-data-making-the-variogram-less-sensitive-to-large-variations-and-outliers." class="level4">
<h4 class="anchored" data-anchor-id="logarithmic-transformations-help-compress-the-range-of-the-data-making-the-variogram-less-sensitive-to-large-variations-and-outliers."><strong>Logarithmic transformations</strong> help compress the range of the data, making the variogram less sensitive to large variations and outliers.</h4>
</section>
<section id="square-root-transformations-can-be-used-to-handle-specific-types-of-data-where-the-variance-is-proportional-to-the-square-of-the-value-or-where-you-want-to-address-non-linearity-between-the-spatial-locations-and-their-variance." class="level4">
<h4 class="anchored" data-anchor-id="square-root-transformations-can-be-used-to-handle-specific-types-of-data-where-the-variance-is-proportional-to-the-square-of-the-value-or-where-you-want-to-address-non-linearity-between-the-spatial-locations-and-their-variance."><strong>Square root transformations</strong> can be used to handle specific types of data where the variance is proportional to the square of the value, or where you want to address non-linearity between the spatial locations and their variance.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lznr.vgm <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lznr.vgm, <span class="at">main =</span> <span class="st">"Variogram of log(zinc)~sqrt(dist)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="fitted-variogram-1" class="level2">
<h2 class="anchored" data-anchor-id="fitted-variogram-1">Fitted Variogram</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lznr.fit <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(lznr.vgm, <span class="at">model =</span> <span class="fu">vgm</span>(<span class="dv">1</span>,<span class="st">"Exp"</span>,<span class="dv">300</span>,<span class="dv">1</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>lznr.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  model      psill    range
1   Nug 0.05712231   0.0000
2   Exp 0.17641559 340.3201</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lznr.vgm,lznr.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kriging" class="level2">
<h2 class="anchored" data-anchor-id="kriging">Kriging</h2>
<section id="kriging-is-a-geostatistical-interpolation-technique-used-to-predict-unknown-values-at-unmeasured-locations-based-on-observed-values-from-nearby-points-while-considering-the-spatial-correlation-between-them.-developed-by-danie-krige-the-method-is-widely-used-in-fields-such-as-geology-meteorology-and-environmental-science.-what-sets-kriging-apart-from-other-interpolation-methods-is-its-ability-to-provide-the-best-linear-unbiased-estimates-by-incorporating-spatial-correlation-through-a-variogram-making-it-particularly-effective-when-data-points-exhibit-spatial-dependencies.-additionally-kriging-not-only-offers-predictions-but-also-quantifies-the-uncertainty-or-confidence-in-those-predictions-making-it-a-valuable-tool-in-spatial-analysis.-it-is-commonly-applied-in-scenarios-where-accurate-spatial-predictions-are-needed-such-as-mapping-pollutant-concentrations-modeling-mineral-deposits-or-analyzing-soil-quality-providing-both-high-accuracy-and-a-robust-measure-of-uncertainty." class="level4">
<h4 class="anchored" data-anchor-id="kriging-is-a-geostatistical-interpolation-technique-used-to-predict-unknown-values-at-unmeasured-locations-based-on-observed-values-from-nearby-points-while-considering-the-spatial-correlation-between-them.-developed-by-danie-krige-the-method-is-widely-used-in-fields-such-as-geology-meteorology-and-environmental-science.-what-sets-kriging-apart-from-other-interpolation-methods-is-its-ability-to-provide-the-best-linear-unbiased-estimates-by-incorporating-spatial-correlation-through-a-variogram-making-it-particularly-effective-when-data-points-exhibit-spatial-dependencies.-additionally-kriging-not-only-offers-predictions-but-also-quantifies-the-uncertainty-or-confidence-in-those-predictions-making-it-a-valuable-tool-in-spatial-analysis.-it-is-commonly-applied-in-scenarios-where-accurate-spatial-predictions-are-needed-such-as-mapping-pollutant-concentrations-modeling-mineral-deposits-or-analyzing-soil-quality-providing-both-high-accuracy-and-a-robust-measure-of-uncertainty.">Kriging is a geostatistical interpolation technique used to predict unknown values at unmeasured locations based on observed values from nearby points, while considering the spatial correlation between them. Developed by Danie Krige, the method is widely used in fields such as geology, meteorology, and environmental science. What sets Kriging apart from other interpolation methods is its ability to provide the best linear unbiased estimates by incorporating spatial correlation through a variogram, making it particularly effective when data points exhibit spatial dependencies. Additionally, Kriging not only offers predictions but also quantifies the uncertainty or confidence in those predictions, making it a valuable tool in spatial analysis. It is commonly applied in scenarios where accurate spatial predictions are needed, such as mapping pollutant concentrations, modeling mineral deposits, or analyzing soil quality, providing both high accuracy and a robust measure of uncertainty.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>lzn.krined <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span> , meuse , meuse.grid, <span class="at">model =</span> lzn.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[using ordinary kriging]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(lzn.krined[<span class="st">"var1.pred"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="condition-simulation" class="level2">
<h2 class="anchored" data-anchor-id="condition-simulation">Condition Simulation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lzn.condsim <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="dv">1</span>,meuse,meuse.grid,<span class="at">model =</span> lzn.fit, <span class="at">nmax =</span><span class="dv">30</span>, <span class="at">nsim =</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>drawing 4 GLS realisations of beta...
[using conditional Gaussian simulation]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(lzn.condsim, <span class="at">main =</span> <span class="st">"Four Condition Simulations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>lzn.condism2 <span class="ot">&lt;-</span> <span class="fu">krige</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="fu">sqrt</span>(dist) , meuse, meuse.grid,<span class="at">model =</span> lznr.fit,<span class="at">nmax =</span> <span class="dv">30</span>,<span class="at">nsim =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>drawing 4 GLS realisations of beta...
[using conditional Gaussian simulation]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spplot</span>(lzn.condism2, <span class="at">main =</span> <span class="st">"Four UK conditional simulations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="directional-variograms" class="level2">
<h2 class="anchored" data-anchor-id="directional-variograms">Directional Variograms</h2>
<section id="a-directional-variogram-is-used-to-analyze-spatial-correlation-in-specific-directions-helping-identify-anisotropy-in-the-data.-while-a-standard-variogram-measures-general-spatial-dependence-a-directional-variogram-reveals-if-the-spatial-correlation-varies-in-different-directions-which-is-important-when-there-are-directional-trends-or-patterns-in-the-data.-this-technique-is-crucial-for-improving-spatial-modeling-refining-prediction-accuracy-and-capturing-complex-spatial-patterns-such-as-those-caused-by-environmental-or-geological-factors-that-influence-data-in-specific-directions." class="level4">
<h4 class="anchored" data-anchor-id="a-directional-variogram-is-used-to-analyze-spatial-correlation-in-specific-directions-helping-identify-anisotropy-in-the-data.-while-a-standard-variogram-measures-general-spatial-dependence-a-directional-variogram-reveals-if-the-spatial-correlation-varies-in-different-directions-which-is-important-when-there-are-directional-trends-or-patterns-in-the-data.-this-technique-is-crucial-for-improving-spatial-modeling-refining-prediction-accuracy-and-capturing-complex-spatial-patterns-such-as-those-caused-by-environmental-or-geological-factors-that-influence-data-in-specific-directions.">A directional variogram is used to analyze spatial correlation in specific directions, helping identify anisotropy in the data. While a standard variogram measures general spatial dependence, a directional variogram reveals if the spatial correlation varies in different directions, which is important when there are directional trends or patterns in the data. This technique is crucial for improving spatial modeling, refining prediction accuracy, and capturing complex spatial patterns, such as those caused by environmental or geological factors that influence data in specific directions.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lzn.dir <span class="ot">=</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="dv">1</span>, meuse, <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>,<span class="dv">90</span>,<span class="dv">135</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>lzn.dir</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    np       dist      gamma dir.hor dir.ver   id
1   12   84.36080 0.05327857       0       0 var1
2   76  165.59800 0.22594655       0       0 var1
3  109  270.29441 0.27321410       0       0 var1
4  134  371.27824 0.33727294       0       0 var1
5  158  478.06480 0.51530169       0       0 var1
6  154  583.35601 0.53927946       0       0 var1
7  159  692.50911 0.54461531       0       0 var1
8  158  797.52941 0.70003994       0       0 var1
9  156  901.86529 0.72419247       0       0 var1
10 156 1011.55318 0.79986927       0       0 var1
11 137 1115.24492 0.93323819       0       0 var1
12 135 1220.31674 0.70397823       0       0 var1
13 109 1328.07859 0.97368467       0       0 var1
14 120 1436.93237 0.79080946       0       0 var1
15  96 1544.68559 0.84408065       0       0 var1
16  11   82.06663 0.07851571      45       0 var1
17  91  165.75829 0.12581005      45       0 var1
18 118  266.93093 0.21333322      45       0 var1
19 136  374.24886 0.29975476      45       0 var1
20 172  479.40618 0.25728477      45       0 var1
21 177  587.53554 0.30815461      45       0 var1
22 209  693.02620 0.38793296      45       0 var1
23 226  796.37554 0.44120638      45       0 var1
24 283  905.25038 0.42951196      45       0 var1
25 264 1012.26326 0.45698113      45       0 var1
26 274 1121.20926 0.47138723      45       0 var1
27 275 1221.63704 0.45200792      45       0 var1
28 282 1330.93431 0.47579482      45       0 var1
29 297 1438.21262 0.46253908      45       0 var1
30 299 1542.75515 0.48603972      45       0 var1
31  16   78.75466 0.08137100      90       0 var1
32  70  160.01667 0.25752667      90       0 var1
33  97  267.68973 0.31944270      90       0 var1
34  98  372.02688 0.47297520      90       0 var1
35 118  479.76226 0.54312552      90       0 var1
36  98  585.85589 0.79275412      90       0 var1
37 115  691.04342 0.67106503      90       0 var1
38 100  796.22142 0.64905100      90       0 var1
39  88  901.26201 1.00392648      90       0 var1
40  72 1004.66642 1.05897331      90       0 var1
41  68 1109.43463 1.03482250      90       0 var1
42  51 1223.73294 1.03760019      90       0 var1
43  44 1322.80887 0.95108448      90       0 var1
44  30 1430.99001 0.79509886      90       0 var1
45  16 1544.27842 0.67142743      90       0 var1
46  18   74.69621 0.23508781     135       0 var1
47  62  163.83075 0.29035174     135       0 var1
48  95  264.21071 0.43081772     135       0 var1
49  89  373.39690 0.62963331     135       0 var1
50  99  475.98691 0.64371046     135       0 var1
51 104  584.05805 0.82403084     135       0 var1
52  91  697.18636 0.89828004     135       0 var1
53  80  792.93648 0.92137119     135       0 var1
54  62  899.44175 0.94030108     135       0 var1
55  51 1014.81674 1.05596218     135       0 var1
56  21 1118.55839 1.15797684     135       0 var1
57  16 1216.88607 0.98703107     135       0 var1
58  17 1323.20745 0.73070849     135       0 var1
59  10 1431.53529 0.27808146     135       0 var1
60   4 1536.74264 0.36274445     135       0 var1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lzn.dir, <span class="at">main =</span><span class="st">"Anisotropic Variogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="this-explanation-is-about-using-directional-variograms-to-understand-how-data-points-are-related-to-each-other-in-different-directions.-a-directional-variogram-looks-at-the-spatial-relationship-between-data-points-in-specific-directions-like-north-east-etc.-and-groups-the-data-based-on-those-directions.-the-variogram-is-symmetric-meaning-the-difference-between-data-points-is-the-same-whether-youre-looking-one-way-or-the-other.-parameters-like-range-distance-where-correlation-becomes-weak-are-calculated-for-each-direction.-the-model-used-may-not-be-perfect-so-its-important-to-check-more-directions-and-refine-the-model-further.-in-simpler-models-like-when-using-regression-the-relationship-between-data-points-is-assumed-to-be-the-same-in-all-directions-isotropic-which-doesnt-take-direction-into-account." class="level4">
<h4 class="anchored" data-anchor-id="this-explanation-is-about-using-directional-variograms-to-understand-how-data-points-are-related-to-each-other-in-different-directions.-a-directional-variogram-looks-at-the-spatial-relationship-between-data-points-in-specific-directions-like-north-east-etc.-and-groups-the-data-based-on-those-directions.-the-variogram-is-symmetric-meaning-the-difference-between-data-points-is-the-same-whether-youre-looking-one-way-or-the-other.-parameters-like-range-distance-where-correlation-becomes-weak-are-calculated-for-each-direction.-the-model-used-may-not-be-perfect-so-its-important-to-check-more-directions-and-refine-the-model-further.-in-simpler-models-like-when-using-regression-the-relationship-between-data-points-is-assumed-to-be-the-same-in-all-directions-isotropic-which-doesnt-take-direction-into-account.">This explanation is about using directional variograms to understand how data points are related to each other in different directions. A directional variogram looks at the spatial relationship between data points in specific directions, like North, East, etc., and groups the data based on those directions. The variogram is symmetric, meaning the difference between data points is the same whether you’re looking one way or the other. Parameters like range (distance where correlation becomes weak) are calculated for each direction. The model used may not be perfect, so it’s important to check more directions and refine the model further. In simpler models, like when using regression, the relationship between data points is assumed to be the same in all directions (isotropic), which doesn’t take direction into account.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>lzndir.fit <span class="ot">=</span> <span class="fu">vgm</span>(<span class="fl">0.59</span>, <span class="st">"Sph"</span>, <span class="dv">1200</span>, <span class="fl">0.05</span>, <span class="at">anis =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="fl">0.25</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lzn.dir, lzndir.fit, <span class="at">as.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="anis-c45-0.25-this-specifies-anisotropy.-the-first-value-45-indicates-the-direction-of-anisotropy-45-degrees-and-the-second-value-0.25-represents-the-anisotropy-ratio-which-compares-the-range-in-the-specified-direction-to-the-range-in-other-directions." class="level5">
<h5 class="anchored" data-anchor-id="anis-c45-0.25-this-specifies-anisotropy.-the-first-value-45-indicates-the-direction-of-anisotropy-45-degrees-and-the-second-value-0.25-represents-the-anisotropy-ratio-which-compares-the-range-in-the-specified-direction-to-the-range-in-other-directions.">anis = c(45, 0.25): This specifies anisotropy. The first value (45) indicates the direction of anisotropy (45 degrees), and the second value (0.25) represents the anisotropy ratio, which compares the range in the specified direction to the range in other directions.</h5>
</section>
<section id="anisotropy-ratio-range-in-direction-1range-in-direction-1" class="level5">
<h5 class="anchored" data-anchor-id="anisotropy-ratio-range-in-direction-1range-in-direction-1">- Anisotropy Ratio = Range in Direction 1/Range in Direction 1</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lznr.dir <span class="ot">=</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse,<span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>,<span class="dv">90</span>,<span class="dv">135</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lznr.dir,lznr.fit, <span class="at">as.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-directional-dependence-is-much-less-obvious-the-fitted-model-here-is-the-fitted-isotropic-model-equal-in-all-directions" class="level5">
<h5 class="anchored" data-anchor-id="the-directional-dependence-is-much-less-obvious-the-fitted-model-here-is-the-fitted-isotropic-model-equal-in-all-directions">The directional dependence is much less obvious; the fitted model here is the fitted isotropic model (equal in all directions)</h5>
</section>
</section>
</section>
<section id="variogram-maps" class="level2">
<h2 class="anchored" data-anchor-id="variogram-maps">Variogram maps</h2>
<section id="a-variogram-map-provides-a-comprehensive-view-of-how-spatial-correlation-varies-across-space-in-both-distance-and-direction.-it-is-especially-useful-for-detecting-anisotropy-and-understanding-the-spatial-structure-of-the-data-which-is-important-for-tasks-like-kriging-and-spatial-modeling." class="level4">
<h4 class="anchored" data-anchor-id="a-variogram-map-provides-a-comprehensive-view-of-how-spatial-correlation-varies-across-space-in-both-distance-and-direction.-it-is-especially-useful-for-detecting-anisotropy-and-understanding-the-spatial-structure-of-the-data-which-is-important-for-tasks-like-kriging-and-spatial-modeling.">A variogram map provides a comprehensive view of how spatial correlation varies across space in both distance and direction. It is especially useful for detecting anisotropy and understanding the spatial structure of the data, which is important for tasks like Kriging and spatial modeling.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>vgm.map <span class="ot">&lt;-</span> <span class="fu">variogram</span>(<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse,<span class="at">cutoff =</span> <span class="dv">2000</span>, <span class="at">width =</span> <span class="dv">100</span>,<span class="at">map =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vgm.map, <span class="at">threshold =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cross-variography" class="level2">
<h2 class="anchored" data-anchor-id="cross-variography">Cross variography</h2>
<section id="cross-variography-is-used-to-analyze-the-spatial-relationship-between-two-different-variables-helping-to-understand-their-co-variation-and-spatial-dependencies.-this-technique-is-important-for-improving-multivariate-spatial-models-and-making-more-accurate-spatial-predictions-by-incorporating-multiple-variables-and-their-inter-relationships." class="level4">
<h4 class="anchored" data-anchor-id="cross-variography-is-used-to-analyze-the-spatial-relationship-between-two-different-variables-helping-to-understand-their-co-variation-and-spatial-dependencies.-this-technique-is-important-for-improving-multivariate-spatial-models-and-making-more-accurate-spatial-predictions-by-incorporating-multiple-variables-and-their-inter-relationships.">Cross variography is used to analyze the spatial relationship between two different variables, helping to understand their co-variation and spatial dependencies. This technique is important for improving multivariate spatial models and making more accurate spatial predictions by incorporating multiple variables and their inter-relationships.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">gstat</span>(<span class="cn">NULL</span>,<span class="st">"log(zn)"</span>,<span class="fu">log</span>(zinc)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">gstat</span>(g,<span class="st">"log(cd)"</span>,<span class="fu">log</span>(cadmium)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">gstat</span>(g,<span class="st">"log(pb)"</span>,<span class="fu">log</span>(lead)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">gstat</span>(g,<span class="st">"log(cu)"</span>,<span class="fu">log</span>(copper)<span class="sc">~</span><span class="fu">sqrt</span>(dist),meuse)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">variogram</span>(g)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">gstat</span>(g,<span class="at">model =</span> <span class="fu">vgm</span>(<span class="dv">1</span>,<span class="st">"Exp"</span>,<span class="dv">300</span>,<span class="dv">1</span>), <span class="at">fill.all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>g.fit <span class="ot">=</span> <span class="fu">fit.lmc</span>(v,g)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>g.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data:
log(zn) : formula = log(zinc)`~`sqrt(dist) ; data dim = 155 x 12
log(cd) : formula = log(cadmium)`~`sqrt(dist) ; data dim = 155 x 12
log(pb) : formula = log(lead)`~`sqrt(dist) ; data dim = 155 x 12
log(cu) : formula = log(copper)`~`sqrt(dist) ; data dim = 155 x 12
variograms:
                   model      psill range
log(zn)[1]           Nug 0.05141798     0
log(zn)[2]           Exp 0.17556219   300
log(cd)[1]           Nug 0.39996573     0
log(cd)[2]           Exp 0.47893816   300
log(pb)[1]           Nug 0.04770893     0
log(pb)[2]           Exp 0.21323027   300
log(cu)[1]           Nug 0.04577523     0
log(cu)[2]           Exp 0.07827374   300
log(zn).log(cd)[1]   Nug 0.09190848     0
log(zn).log(cd)[2]   Exp 0.24542024   300
log(zn).log(pb)[1]   Nug 0.04528367     0
log(zn).log(pb)[2]   Exp 0.18407011   300
log(cd).log(pb)[1]   Nug 0.06425412     0
log(cd).log(pb)[2]   Exp 0.25525359   300
log(zn).log(cu)[1]   Nug 0.02912806     0
log(zn).log(cu)[2]   Exp 0.10438748   300
log(cd).log(cu)[1]   Nug 0.09441635     0
log(cd).log(cu)[2]   Exp 0.13073936   300
log(pb).log(cu)[1]   Nug 0.02369778     0
log(pb).log(cu)[2]   Exp 0.10267516   300</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v,g.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>vgm.map <span class="ot">=</span> <span class="fu">variogram</span>(g, <span class="at">cutoff =</span><span class="dv">1500</span> ,<span class="at">width =</span> <span class="dv">100</span>, <span class="at">map =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vgm.map, <span class="at">threshold =</span> <span class="dv">5</span>, <span class="at">col.regions =</span> <span class="fu">bpy.colors</span>(), <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gstat_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
